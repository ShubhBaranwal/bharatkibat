import { NextRequest, NextResponse } from "next/server";
import dbConnect from "@/lib/db";
import Content from "@/models/Content";
import Category from "@/models/Category";

export async function GET(req: NextRequest) {
    try {
        await dbConnect();

        // 1. Find the Category ID for "Politics" (or fallback)
        let category = await Category.findOne({ name: "Politics" });
        if (!category) {
            category = await Category.findOne({ name: { $regex: /rajneeti/i } });
        }

        if (!category) {
            return NextResponse.json({ error: "Category not found" }, { status: 404 });
        }

        const categoryId = category._id;

        // 2. Prepare the content data with CORRECT Block Structure
        const articleData = {
            title: "राजा भैया (रघुराज प्रताप सिंह): भदरी रियासत से कुंडा के ‘जनसत्ता’ तक का सफर",
            slug: "raja-bhaiya-raghuraj-pratap-singh-biography-kunda",
            type: "biography",
            categoryId: categoryId,
            author: "Bharat Ki Baat Desk",
            coverImage: "https://res.cloudinary.com/ddy5pkbkc/image/upload/v1766483161/raja_bhaiya_qqccqj.jpg",
            tags: [
                "राजा भैया",
                "रघुराज प्रताप सिंह",
                "कुंडा",
                "जनसत्ता दल लोकतांत्रिक",
                "उत्तर प्रदेश राजनीति",
                "भदरी रियासत",
                "जीवनी",
                "Raja Bhaiya",
                "Raghuraj Pratap Singh",
                "Kunda"
            ],
            contentBlocks: [
                {
                    type: "heading",
                    data: {
                        text: "शाही विरासत में पले, परंपराओं और अनुशासन के बीच गढ़ी गई पहचान",
                        level: 2
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "औध की भदरी रियासत से जुड़ा परिवार, शिक्षा और संस्कारों से बना शुरुआती संसार",
                        level: 3
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "रघुराज प्रताप सिंह, जिन्हें उत्तर प्रदेश की राजनीति में राजा भैया के नाम से जाना जाता है, का जन्म 31 अक्टूबर 1969 को तत्कालीन कलकत्ता में हुआ। उनका परिवार औध क्षेत्र की ऐतिहासिक भदरी रियासत से जुड़ा रहा है, जिसकी पहचान लंबे समय से सामाजिक प्रभाव और प्रशासनिक समझ के लिए रही है।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "पिता राजा उदय प्रताप सिंह शिक्षा और संस्थागत गतिविधियों से जुड़े रहे और सार्वजनिक राजनीति से दूरी बनाए रखी। घर का वातावरण अनुशासन और अध्ययन पर आधारित रहा। माता मंजुल राजे ने पारिवारिक परंपराओं और सांस्कृतिक मूल्यों को आगे बढ़ाने में अहम भूमिका निभाई।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "दादा राजा बजरंग बहादुर सिंह का नाम कृषि शिक्षा और प्रशासनिक सेवा से जुड़ा रहा, जिससे परिवार में जिम्मेदारी और सामाजिक दायित्व की भावना स्वाभाविक रूप से मौजूद रही। बचपन ऐसे परिवेश में बीता जहाँ आत्मसंयम, अनुशासन और सामाजिक मर्यादाएँ जीवन का हिस्सा थीं। यही संस्कार आगे चलकर उनके व्यक्तित्व की बुनियाद बने।"
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "पढ़ाई से बनी दृष्टि: परंपरा और आधुनिक शिक्षा के बीच आकार लेती सोच",
                        level: 2
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "विद्यालयी अनुशासन, विषयों की विविधता और रुचियों से बना शैक्षणिक आधार",
                        level: 3
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "राजा भैया की शुरुआती शिक्षा प्रयागराज के नारायणी आश्रम स्थित महाप्रभु बाल विद्यालय में हुई, जहाँ पढ़ाई के साथ सादगी और आत्मनियंत्रण पर जोर दिया जाता था। आगे चलकर उन्होंने भारत स्काउट एंड गाइड हाई स्कूल से हाईस्कूल और कर्नलगंज इंटर कॉलेज से इंटरमीडिएट की पढ़ाई पूरी की।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "इस दौर में इतिहास और अनुशासन आधारित विषयों में उनकी रुचि साफ दिखती थी। उच्च शिक्षा के लिए उन्होंने लखनऊ विश्वविद्यालय का रुख किया, जहाँ से विधि की पढ़ाई पूरी की। साथ ही मिलिट्री साइंस और भारतीय मध्यकालीन इतिहास का अध्ययन किया।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "शिक्षा के साथ घुड़सवारी और शूटिंग जैसे पारंपरिक शौक उनके व्यक्तित्व का हिस्सा बने। पढ़ाई और रुचियों के इस संतुलन ने उनके सोचने के तरीके और निर्णय क्षमता को आकार दिया, जो आगे के सार्वजनिक जीवन में काम आया।"
                    }
                },
                {
                    type: "image",
                    data: {
                        file: { url: "https://res.cloudinary.com/ddy5pkbkc/image/upload/v1766483161/raja_bhaiya_qqccqj.jpg" },
                        caption: "रघुराज प्रताप सिंह (राजा भैया)"
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "स्थानीय प्रभाव से सत्ता के गलियारों तक: एक स्वतंत्र राजनीतिक राह",
                        level: 2
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "कुंडा से शुरू हुआ सफर, जिसने राज्य राजनीति में अलग पहचान बनाई",
                        level: 3
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "राजा भैया ने 1993 में कुंडा विधानसभा सीट से निर्दलीय चुनाव जीतकर राजनीति में कदम रखा। कम उम्र में मिली यह जीत उन्हें क्षेत्रीय राजनीति में एक अलग पहचान देती है। इसके बाद वे लगातार उसी सीट से जीत दर्ज करते रहे।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "1997 से 2000 के बीच भाजपा नेतृत्व वाली सरकारों में मंत्री रहते हुए उन्हें प्रशासनिक अनुभव मिला। 2002 का दौर उनके लिए चुनौतीपूर्ण रहा, जब उन पर गंभीर आरोप लगे और निरोधात्मक कार्रवाई हुई। बाद में आरोप हटने के बाद समाजवादी पार्टी की सरकार में उन्हें फिर से मंत्री बनाया गया।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "2012 में अखिलेश यादव सरकार में भी वे मंत्रिमंडल का हिस्सा रहे। 2013 में एक मामले के बाद उन्होंने मंत्री पद छोड़ा, हालांकि जांच पूरी होने के बाद उनकी राजनीतिक सक्रियता बनी रही। 2018 में जनसत्ता दल लोकतांत्रिक की स्थापना उनके स्वतंत्र राजनीतिक रुख को दर्शाती है।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "राज्य की सत्ता राजनीति में कुछ मौकों पर उनकी भूमिका चर्चा में रही।"
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "स्थानीय राजनीति में स्थायी प्रभाव: जनसमर्थन और प्रशासनिक भूमिका",
                        level: 2
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "कुंडा और आसपास के क्षेत्रों में सामाजिक-राजनीतिक पकड़ का असर",
                        level: 3
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "लगभग तीन दशक से कुंडा का प्रतिनिधित्व करते हुए राजा भैया का नाम स्थानीय राजनीति में गहरी पकड़ के साथ जुड़ा रहा है। अलग-अलग सरकारों में मंत्री रहते हुए उन्होंने खाद्य एवं नागरिक आपूर्ति और कारागार जैसे विभागों की जिम्मेदारी संभाली, जिनका सीधा संबंध आम जनता और प्रशासन से है।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "स्थानीय स्तर पर आयोजित सामूहिक विवाह और अन्य सामाजिक कार्यक्रमों में उनकी भागीदारी की जानकारी सामने आती रही है। कुंडा क्षेत्र में उनकी भूमिका को स्थानीय राजनीतिक पर्यवेक्षकों के अनुसार प्रशासनिक हस्तक्षेप और विवाद समाधान से जोड़ा जाता रहा है। उनका योगदान सत्ता, क्षेत्रीय प्रभाव और जनसंपर्क के संतुलन के रूप में देखा जाता है।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "2018 में गठित उनकी पार्टी ने 2022 के विधानसभा चुनाव में सीमित लेकिन उल्लेखनीय मौजूदगी दर्ज कराई।"
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "वर्तमान भूमिका में सक्रिय मौजूदगी: क्षेत्रीय नेतृत्व की जिम्मेदारी",
                        level: 2
                    }
                },
                {
                    type: "heading",
                    data: {
                        text: "स्थानीय सरोकारों पर केंद्रित, व्यावहारिक और स्वतंत्र कार्यशैली",
                        level: 3
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "राजा भैया वर्तमान में कुंडा विधानसभा सीट से विधायक हैं और जनसत्ता दल लोकतांत्रिक के राष्ट्रीय अध्यक्ष की जिम्मेदारी संभाल रहे हैं। वे राज्य सरकार का हिस्सा नहीं हैं, लेकिन क्षेत्रीय राजनीति में उनकी मौजूदगी प्रभावशाली मानी जाती है।"
                    }
                },
                {
                    type: "paragraph",
                    data: {
                        text: "उपलब्ध जानकारी के अनुसार, उनका राजनीतिक फोकस वर्तमान में स्थानीय सरोकार और स्वतंत्र नेतृत्व पर केंद्रित है। उनकी कार्यशैली सीधे संवाद और स्थानीय समस्याओं पर केंद्रित रही है। संगठन को सक्रिय रखना और विधानसभा के माध्यम से क्षेत्रीय मुद्दे उठाना उनकी प्राथमिकता है।"
                    }
                }
            ],
            meta: {
                title: "राजा भैया (रघुराज प्रताप सिंह): भदरी रियासत से कुंडा के ‘जनसत्ता’ तक का सफर",
                description: "उत्तर प्रदेश के कुंडा से विधायक राजा भैया (रघुराज प्रताप सिंह) की जीवनी। भदरी रियासत के संस्कार, शिक्षा, राजनीतिक सफर और जनसत्ता दल लोकतांत्रिक के गठन की पूरी कहानी।",
                keywords: [
                    "राजा भैया",
                    "रघुराज प्रताप सिंह",
                    "कुंडा",
                    "जनसत्ता दल लोकतांत्रिक",
                    "उत्तर प्रदेश राजनीति",
                    "भदरी रियासत",
                    "जीवनी",
                    "Raja Bhaiya",
                    "Raghuraj Pratap Singh",
                    "Kunda"
                ],
                ogImage: "https://res.cloudinary.com/ddy5pkbkc/image/upload/v1766483161/raja_bhaiya_qqccqj.jpg"
            },
            published: true,
            views: 1200,
            createdAt: new Date(),
            updatedAt: new Date()
        };

        // 3. Update or Insert the article
        await Content.findOneAndUpdate(
            { slug: articleData.slug },
            articleData,
            { upsert: true, new: true }
        );

        return NextResponse.json({ message: "Seed success", data: articleData });
    } catch (error: any) {
        console.error("Seed error:", error);
        // Ensure error is a standard object before returning
        const errorResponse = {
            message: error.message || "Unknown error",
            stack: error.stack
        };
        return NextResponse.json({ error: errorResponse }, { status: 500 });
    }
}
